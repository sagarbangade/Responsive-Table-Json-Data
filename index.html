<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Management</title>
</head>
<body>
    <h2>Update Data</h2>
    <label for="updateKey">Course Name: </label>
    <input type="text" id="updateKey">
    <label for="updateValue">New Fees Details: </label>
    <input type="text" id="updateValue">
    <button onclick="updateData()">Update</button>

    <h2>Insert Data</h2>
    <label for="insertKey">Course Name: </label>
    <input type="text" id="insertKey">
    <label for="insertValue">Fees Details: </label>
    <input type="text" id="insertValue">
    <button onclick="insertData()">Insert</button>

    <h2>Delete Data</h2>
    <label for="deleteKey">Course Name: </label>
    <input type="text" id="deleteKey">
    <button onclick="deleteData()">Delete</button>

    <h2>Data Table</h2>
    <table id="dataTable" border="1">
        <thead>
            <tr>
                <th>Sr.</th>
                <th>Image</th>
                <th>Course</th>
                <th>Duration</th>
                <th>Course Details Link</th>
                <th>Fees Details Link</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        // Function to fetch JSON data from courses.json
        async function fetchData() {
            const response = await fetch('courses.json'); // Replace with your file path
            const data = await response.json();
            return data;
        }

        // Initialize the table with data
        async function initializeTable() {
            const jsonData = await fetchData();
            const tableBody = document.querySelector("tbody");

            jsonData.forEach(item => {
                const row = document.createElement("tr");
                for (const key in item) {
                    const cell = document.createElement("td");
                    cell.textContent = item[key];
                    row.appendChild(cell);
                }
                tableBody.appendChild(row);
            });
        }

        initializeTable();

        // Function to update data
        async function updateData() {
            const key = document.getElementById("updateKey").value;
            const newValue = document.getElementById("updateValue").value;

            const jsonData = await fetchData();

            const itemToUpdate = jsonData.find(item => item["Course"] === key);
            if (itemToUpdate) {
                itemToUpdate["Fees Details Link"] = newValue;

                // Update the JSON file (courses.json) on the server
                await updateJsonFile(jsonData);

                // Refresh the table
                initializeTable();
            }
        }

        // Function to insert data
        async function insertData() {
            const key = document.getElementById("insertKey").value;
            const value = document.getElementById("insertValue").value;

            const jsonData = await fetchData();

            // Check if the course name already exists
            const courseExists = jsonData.some(item => item["Course"] === key);
            if (courseExists) {
                alert("Course already exists. Use the update function to modify it.");
                return;
            }

            // Add the new data
            jsonData.push({
                "Course": key,
                "Image": "IMG/Java-Logo.jpg",
                "Duration": "New Duration",
                "Course Details Link": "New Link",
                "Fees Details Link": value
            });

            // Update the JSON file (courses.json) on the server
            await updateJsonFile(jsonData);

            // Refresh the table
            initializeTable();
        }

        // Function to delete data
        async function deleteData() {
            const key = document.getElementById("deleteKey").value;

            const jsonData = await fetchData();

            // Find the index of the item to delete
            const indexToDelete = jsonData.findIndex(item => item["Course"] === key);

            if (indexToDelete > -1) {
                // Remove the item from the array
                jsonData.splice(indexToDelete, 1);

                // Update the JSON file (courses.json) on the server
                await updateJsonFile(jsonData);

                // Refresh the table
                initializeTable();
            }
        }

        // Function to update the JSON file on the server
        async function updateJsonFile(data) {
            const response = await fetch('update_json.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            if (!response.ok) {
                throw new Error(`Failed to update JSON file: ${response.status} ${response.statusText}`);
            }
        }
    </script>
</body>
</html>
